generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                                                                             Int                          @id @default(autoincrement()) @map("IdentifiantUtilisateur")
  Nom                                                                            String                       @db.VarChar(100)
  Prenom                                                                         String                       @db.VarChar(100)
  Email                                                                          String                       @unique @db.VarChar(255)
  MotDePasse                                                                     String                       @db.VarChar(255)
  NumeroTelephone                                                                String?                      @db.VarChar(20)
  DateNaissance                                                                  DateTime?                    @db.Date
  PhotoProfil                                                                    String?                      @db.VarChar(500)
  TypeUtilisateur                                                                String                       @db.VarChar(20)
  StatutCompte                                                                   String?                      @default("Actif") @db.VarChar(20)
  EmailVerifie                                                                   Boolean?                     @default(false)
  TelephoneVerifie                                                               Boolean?                     @default(false)
  DateInscription                                                                DateTime?                    @default(now()) @db.Timestamptz()
  DerniereConnexion                                                              DateTime?                    @db.Timestamptz()
  AdresseIP                                                                      String?                      @db.VarChar(45)
  DeviceInfo                                                                     String?                      @db.VarChar(500)
  LanguePreferee                                                                 String?                      @default("fr") @db.VarChar(10)
  DevisePreferee                                                                 String?                      @default("XOF") @db.VarChar(3)
  BiographieUtilisateur                                                          String?                      @db.Text
  SiteWeb                                                                        String?                      @db.VarChar(255)
  ReseauxSociaux                                                                 String?                      @db.Text
  NotesUtilisateur                                                               Decimal?                     @default(0.00) @db.Decimal(3, 2)
  NombreReservationsEffectuees                                                   Int?                         @default(0)
  NombreVehiculesLoues                                                           Int?                         @default(0)
  MembreDepuis                                                                   Int?
  NiveauFidelite                                                                 String?                      @default("BRONZE") @db.VarChar(20)
  PointsFideliteTotal                                                            Int?                         @default(0)
  A_B_Tests                                                                      A_B_Tests[]
  adresses                                                                       AdresseUtilisateur[]
  aggregations                                                                   AggregationUtilisateur?
  avisAuteur                                                                     Avis[]                       @relation("ReviewAuthor")
  CodesPromo                                                                     CodePromo[]
  ConfigurationBusinessRules_ConfigurationBusinessRules_CreeParToUtilisateurs    ConfigurationBusinessRules[] @relation("ConfigurationBusinessRules_CreeParToUtilisateurs")
  ConfigurationBusinessRules_ConfigurationBusinessRules_ModifieParToUtilisateurs ConfigurationBusinessRules[] @relation("ConfigurationBusinessRules_ModifieParToUtilisateurs")
  Conversations_Conversations_IdentifiantUtilisateur1ToUtilisateurs              Conversations[]              @relation("Conversations_IdentifiantUtilisateur1ToUtilisateurs")
  Conversations_Conversations_IdentifiantUtilisateur2ToUtilisateurs              Conversations[]              @relation("Conversations_IdentifiantUtilisateur2ToUtilisateurs")
  documents                                                                      DocumentUtilisateur[]
  DocumentsUtilisateurs_DocumentsUtilisateurs_VerifieParToUtilisateurs           DocumentUtilisateur[]        @relation("DocumentsUtilisateurs_VerifieParToUtilisateurs")
  DonneesChiffrees                                                               DonneesChiffrees[]
  Factures                                                                       Facture[]
  favoris                                                                        Favori[]
  Incidents                                                                      Incident[]
  JournalAudit                                                                   JournalAudit[]
  LogsErreurs                                                                    LogsErreurs[]
  Messages_Messages_IdentifiantDestinataireToUtilisateurs                        Message[]                    @relation("Messages_IdentifiantDestinataireToUtilisateurs")
  messages                                                                       Message[]                    @relation("SenderMessages")
  MethodesPaiementUtilisateurs                                                   MethodePaiementUtilisateur[]
  notifications                                                                  Notification[]
  pointsFidelite                                                                 PointFidelite[]
  preferences                                                                    PreferenceUtilisateur?
  filleulages                                                                    ProgrammeParrainage[]        @relation("Referred")
  parrainages                                                                    ProgrammeParrainage[]        @relation("Referrer")
  recherchesSauvegardees                                                         RecherchesSauvegardee[]
  Reclamations_Reclamations_AssigneAToUtilisateurs                               Reclamation[]                @relation("Reclamations_AssigneAToUtilisateurs")
  reclamations                                                                   Reclamation[]                @relation("ComplaintUser")
  reservationsAnnulees                                                           Reservation[]                @relation("CanceledBy")
  reservationsLocataire                                                          Reservation[]                @relation("RenterBookings")
  reservationsProprietaire                                                       Reservation[]                @relation("OwnerBookings")
  SignalementsAvis_SignalementsAvis_IdentifiantSignaleurToUtilisateurs           SignalementsAvis[]           @relation("SignalementsAvis_IdentifiantSignaleurToUtilisateurs")
  SignalementsAvis_SignalementsAvis_TraiteParToUtilisateurs                      SignalementsAvis[]           @relation("SignalementsAvis_TraiteParToUtilisateurs")
  transactions                                                                   Transaction[]
  UtilisationsCodesPromo                                                         UtilisationCodePromo[]
  vehiculesProprietaire                                                          Vehicle[]                    @relation("VehicleOwner")

  @@index([DateInscription])
  @@index([Email])
  @@index([NiveauFidelite])
  @@index([StatutCompte])
  @@index([TypeUtilisateur])
  @@map("Utilisateurs")
}

model AdresseUtilisateur {
  id                   Int       @id @default(autoincrement()) @map("IdentifiantAdresse")
  utilisateurId        Int       @map("IdentifiantUtilisateur")
  TypeAdresse          String    @db.VarChar(20)
  AdresseLigne1        String    @db.VarChar(255)
  AdresseLigne2        String?   @db.VarChar(255)
  Ville                String    @db.VarChar(100)
  Region               String?   @db.VarChar(100)
  CodePostal           String?   @db.VarChar(20)
  Pays                 String    @default("Senegal") @db.VarChar(100)
  Latitude             Decimal?  @db.Decimal(10, 8)
  Longitude            Decimal?  @db.Decimal(11, 8)
  EstAdressePrincipale Boolean?  @default(false)
  DateAjout            DateTime? @default(now()) @db.Timestamptz()
  utilisateur          User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([TypeAdresse])
  @@index([utilisateurId])
  @@map("AdressesUtilisateurs")
}

model DocumentUtilisateur {
  id                                                          Int       @id @default(autoincrement()) @map("IdentifiantDocument")
  utilisateurId                                               Int       @map("IdentifiantUtilisateur")
  TypeDocument                                                String    @db.VarChar(50)
  NomFichier                                                  String    @db.VarChar(255)
  CheminFichier                                               String    @db.VarChar(500)
  TailleFichier                                               BigInt?
  FormatFichier                                               String?   @db.VarChar(10)
  NumeroDocument                                              String?   @db.VarChar(100)
  DateExpiration                                              DateTime? @db.Date
  StatutVerification                                          String?   @default("EnAttente") @db.VarChar(20)
  DateTeleversement                                           DateTime? @default(now()) @db.Timestamptz()
  DateVerification                                            DateTime? @db.Timestamptz()
  VerifiePar                                                  Int?
  CommentairesVerification                                    String?   @db.VarChar(500)
  HashFichier                                                 Bytes?
  utilisateur                                                 User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Utilisateurs_DocumentsUtilisateurs_VerifieParToUtilisateurs User?     @relation("DocumentsUtilisateurs_VerifieParToUtilisateurs", fields: [VerifiePar], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([DateExpiration])
  @@index([StatutVerification])
  @@index([TypeDocument])
  @@index([utilisateurId])
  @@map("DocumentsUtilisateurs")
}

model PreferenceUtilisateur {
  id                        Int       @id @default(autoincrement()) @map("IdentifiantPreference")
  utilisateurId             Int       @unique @map("IdentifiantUtilisateur")
  NotificationsEmail        Boolean?  @default(true)
  NotificationsSMS          Boolean?  @default(true)
  NotificationsPush         Boolean?  @default(true)
  NotificationsReservations Boolean?  @default(true)
  NotificationsPromotions   Boolean?  @default(false)
  NotificationsMessages     Boolean?  @default(true)
  NotificationsAvis         Boolean?  @default(true)
  ModeTheme                 String?   @default("Clair") @db.VarChar(10)
  AffichageMonnaie          String?   @default("XOF") @db.VarChar(3)
  FormatDate                String?   @default("DD/MM/YYYY") @db.VarChar(20)
  FuseauHoraire             String?   @default("Africa/Dakar") @db.VarChar(50)
  VisibiliteProfile         String?   @default("Public") @db.VarChar(20)
  AfficherNumeroTelephone   Boolean?  @default(false)
  AfficherEmail             Boolean?  @default(false)
  AutoriserMessages         Boolean?  @default(true)
  DateMiseAJour             DateTime? @default(now()) @db.Timestamptz()
  utilisateur               User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("PreferencesUtilisateurs")
}

model TentativeConnexion {
  id            Int       @id @default(autoincrement()) @map("IdentifiantTentative")
  AdresseEmail  String    @db.VarChar(150)
  AdresseIP     String    @db.VarChar(50)
  Reussie       Boolean?  @default(false)
  CodeErreur    String?   @db.VarChar(50)
  MotifEchec    String?   @db.VarChar(255)
  DateTentative DateTime? @default(now()) @db.Timestamptz()
  UserAgent     String?   @db.VarChar(500)
  Pays          String?   @db.VarChar(100)

  @@index([AdresseEmail, DateTentative])
  @@index([AdresseIP, DateTentative])
  @@index([Reussie])
  @@map("TentativesConnexion")
}

model CategorieVehicule {
  id                   Int       @id @default(autoincrement()) @map("IdentifiantCategorie")
  NomCategorie         String    @unique @db.VarChar(100)
  DescriptionCategorie String?   @db.VarChar(500)
  IconeCategorie       String?   @db.VarChar(255)
  OrdreAffichage       Int?      @default(0)
  EstActif             Boolean?  @default(true)
  DateCreation         DateTime? @default(now()) @db.Timestamptz()
  vehicules            Vehicle[]

  @@map("CategoriesVehicules")
}

model MarqueVehicule {
  id           Int              @id @default(autoincrement()) @map("IdentifiantMarque")
  NomMarque    String           @unique @db.VarChar(100)
  LogoMarque   String?          @db.VarChar(255)
  PaysOrigine  String?          @db.VarChar(100)
  SiteWeb      String?          @db.VarChar(255)
  EstPopulaire Boolean?         @default(false)
  DateAjout    DateTime?        @default(now()) @db.Timestamptz()
  modeles      ModeleVehicule[]

  @@index([EstPopulaire])
  @@map("MarquesVehicules")
}

model ModeleVehicule {
  id                  Int            @id @default(autoincrement()) @map("IdentifiantModele")
  marqueId            Int            @map("IdentifiantMarque")
  NomModele           String         @db.VarChar(100)
  AnneeDebut          Int?
  AnneeFin            Int?
  TypeCarburant       String?        @db.VarChar(50)
  TypeTransmission    String?        @db.VarChar(50)
  NombrePlaces        Int?
  NombrePortes        Int?
  CapaciteCoffre      Int?
  ConsommationMoyenne Decimal?       @db.Decimal(5, 2)
  ImageModele         String?        @db.VarChar(255)
  DateAjout           DateTime?      @default(now()) @db.Timestamptz()
  marque              MarqueVehicule @relation(fields: [marqueId], references: [id], onUpdate: NoAction)
  vehicules           Vehicle[]

  @@index([TypeCarburant])
  @@index([marqueId])
  @@map("ModelesVehicules")
}

model Vehicle {
  id                             Int                          @id @default(autoincrement()) @map("IdentifiantVehicule")
  proprietaireId                 Int                          @map("IdentifiantProprietaire")
  categorieId                    Int                          @map("IdentifiantCategorie")
  modeleId                       Int                          @map("IdentifiantModele")
  TitreAnnonce                   String                       @db.VarChar(200)
  DescriptionVehicule            String?                      @db.Text
  Immatriculation                String?                      @unique @db.VarChar(50)
  Annee                          Int
  Couleur                        String?                      @db.VarChar(50)
  Kilometrage                    Int?                         @default(0)
  NumeroChassisVIN               String?                      @unique @db.VarChar(50)
  NombrePlaces                   Int
  TypeCarburant                  String                       @db.VarChar(50)
  TypeTransmission               String                       @db.VarChar(50)
  Climatisation                  Boolean?                     @default(false)
  GPS                            Boolean?                     @default(false)
  Bluetooth                      Boolean?                     @default(false)
  CameraRecul                    Boolean?                     @default(false)
  SiegesEnCuir                   Boolean?                     @default(false)
  ToitOuvrant                    Boolean?                     @default(false)
  RegulateursVitesse             Boolean?                     @default(false)
  AirbagsMultiples               Boolean?                     @default(false)
  EquipementsSupplementaires     String?                      @db.Text
  PrixJournalier                 Decimal                      @db.Decimal(10, 2)
  PrixHebdomadaire               Decimal?                     @db.Decimal(10, 2)
  PrixMensuel                    Decimal?                     @db.Decimal(10, 2)
  CautionRequise                 Decimal?                     @default(0) @db.Decimal(10, 2)
  KilometrageInclus              Int?                         @default(200)
  FraisKilometrageSupplementaire Decimal?                     @default(0) @db.Decimal(10, 2)
  LocalisationVille              String                       @db.VarChar(100)
  LocalisationRegion             String?                      @db.VarChar(100)
  AdresseComplete                String?                      @db.VarChar(500)
  Latitude                       Decimal?                     @db.Decimal(10, 8)
  Longitude                      Decimal?                     @db.Decimal(11, 8)
  DisponibiliteLundi             Boolean?                     @default(true)
  DisponibiliteMardi             Boolean?                     @default(true)
  DisponibiliteMercredi          Boolean?                     @default(true)
  DisponibiliteJeudi             Boolean?                     @default(true)
  DisponibiliteVendredi          Boolean?                     @default(true)
  DisponibiliteSamedi            Boolean?                     @default(true)
  DisponibiliteDimanche          Boolean?                     @default(true)
  HeureDebutDisponibilite        DateTime?                    @default(dbgenerated("'08:00'::time")) @db.Time()
  HeureFinDisponibilite          DateTime?                    @default(dbgenerated("'20:00'::time")) @db.Time()
  LivraisonPossible              Boolean?                     @default(false)
  FraisLivraison                 Decimal?                     @default(0) @db.Decimal(10, 2)
  RayonLivraison                 Int?
  StatutVehicule                 String?                      @default("Actif") @db.VarChar(20)
  StatutVerification             String?                      @default("EnAttente") @db.VarChar(20)
  NotesVehicule                  Decimal?                     @default(0.00) @db.Decimal(3, 2)
  NombreReservations             Int?                         @default(0)
  NombreVues                     Int?                         @default(0)
  DateCreation                   DateTime?                    @default(now()) @db.Timestamptz()
  DateDerniereModification       DateTime?                    @default(now()) @db.Timestamptz()
  DateDerniereReservation        DateTime?                    @db.Timestamptz()
  EstPromotion                   Boolean?                     @default(false)
  EstVedette                     Boolean?                     @default(false)
  EstAssure                      Boolean?                     @default(false)
  CompagnieAssurance             String?                      @db.VarChar(200)
  NumeroPoliceAssurance          String?                      @db.VarChar(100)
  DateExpirationAssurance        DateTime?                    @db.Date
  DernierEntretien               DateTime?                    @db.Date
  ProchainEntretien              DateTime?                    @db.Date
  TarificationDynamiqueActive    Boolean?                     @default(false)
  TauxOccupationActuel           Decimal?                     @default(0.00) @db.Decimal(5, 2)
  caracteristiquesTechniques     CaracteristiqueTechnique[]
  Conversations                  Conversations[]
  favoris                        Favori[]
  historiquePrix                 HistoriquePrixVehicule[]
  incidents                      Incident[]
  photos                         PhotoVehicule[]
  reglesTarification             RegleTarificationDynamique[]
  reservations                   Reservation[]
  categorie                      CategorieVehicule            @relation(fields: [categorieId], references: [id], onUpdate: NoAction)
  modele                         ModeleVehicule               @relation(fields: [modeleId], references: [id], onUpdate: NoAction)
  proprietaire                   User                         @relation("VehicleOwner", fields: [proprietaireId], references: [id], onUpdate: NoAction)

  @@index([categorieId])
  @@index([DateCreation])
  @@index([Latitude, Longitude])
  @@index([modeleId])
  @@index([NotesVehicule])
  @@index([PrixJournalier])
  @@index([EstPromotion])
  @@index([proprietaireId])
  @@index([StatutVehicule])
  @@index([EstVedette])
  @@index([LocalisationVille])
  @@index([StatutVehicule, EstVedette, NotesVehicule])
  @@index([TypeCarburant])
  @@index([TypeTransmission])
  @@index([NombrePlaces])
  @@index([proprietaireId, StatutVehicule])
  @@map("Vehicules")
}

model PhotoVehicule {
  id                 Int       @id @default(autoincrement()) @map("IdentifiantPhoto")
  vehiculeId         Int       @map("IdentifiantVehicule")
  URLPhoto           String    @db.VarChar(500)
  URLMiniature       String?   @db.VarChar(500)
  LegendePhoto       String?   @db.VarChar(255)
  OrdreAffichage     Int?      @default(0)
  EstPhotoPrincipale Boolean?  @default(false)
  TailleFichier      BigInt?
  FormatImage        String?   @db.VarChar(10)
  DateAjout          DateTime? @default(now()) @db.Timestamptz()
  vehicule           Vehicle   @relation(fields: [vehiculeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([EstPhotoPrincipale])
  @@index([vehiculeId])
  @@map("PhotosVehicules")
}

model CaracteristiqueTechnique {
  id                 Int       @id @default(autoincrement()) @map("IdentifiantCaracteristique")
  vehiculeId         Int       @map("IdentifiantVehicule")
  Puissance          Int?
  Couple             Int?
  VitesseMaximale    Int?
  Acceleration       Decimal?  @db.Decimal(4, 2)
  CapaciteReservoir  Int?
  PoidsVide          Int?
  ChargeUtile        Int?
  LongueurVehicule   Int?
  LargeurVehicule    Int?
  HauteurVehicule    Int?
  EmpatementVehicule Int?
  NormeEmission      String?   @db.VarChar(50)
  TypeRoueMotrice    String?   @db.VarChar(50)
  DateAjout          DateTime? @default(now()) @db.Timestamptz()
  vehicule           Vehicle   @relation(fields: [vehiculeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("CaracteristiquesTechniques")
}

model Reservation {
  id                               Int                    @id @default(autoincrement()) @map("IdentifiantReservation")
  NumeroReservation                String                 @unique @default("") @db.VarChar(50)
  vehiculeId                       Int                    @map("IdentifiantVehicule")
  locataireId                      Int                    @map("IdentifiantLocataire")
  proprietaireId                   Int                    @map("IdentifiantProprietaire")
  DateDebut                        DateTime               @db.Timestamptz()
  DateFin                          DateTime               @db.Timestamptz()
  DateCreationReservation          DateTime?              @default(now()) @db.Timestamptz()
  HeureDebut                       DateTime?              @db.Time()
  HeureFin                         DateTime?              @db.Time()
  LieuPriseEnCharge                String?                @db.VarChar(500)
  LieuRestitution                  String?                @db.VarChar(500)
  LivraisonDemandee                Boolean?               @default(false)
  AdresseLivraison                 String?                @db.VarChar(500)
  FraisLivraison                   Decimal?               @default(0) @db.Decimal(10, 2)
  NombreJours                      Int?
  PrixJournalier                   Decimal                @db.Decimal(10, 2)
  MontantLocation                  Decimal                @db.Decimal(10, 2)
  MontantCaution                   Decimal?               @default(0) @db.Decimal(10, 2)
  FraisService                     Decimal?               @default(0) @db.Decimal(10, 2)
  FraisAssurance                   Decimal?               @default(0) @db.Decimal(10, 2)
  FraisSupplementaires             Decimal?               @default(0) @db.Decimal(10, 2)
  DetailsSupplementaires           String?                @db.Text
  Remise                           Decimal?               @default(0) @db.Decimal(10, 2)
  CodePromo                        String?                @db.VarChar(50)
  MontantTotal                     Decimal                @db.Decimal(10, 2)
  StatutReservation                String?                @default("EnAttente") @db.VarChar(30)
  StatutPaiement                   String?                @default("EnAttente") @db.VarChar(30)
  MethodePaiement                  String?                @db.VarChar(50)
  KilometrageDepart                Int?
  KilometrageRetour                Int?
  KilometrageParcouru              Int?
  KilometrageInclus                Int?                   @default(200)
  FraisKilometrageSupplementaire   Decimal?               @default(0) @db.Decimal(10, 2)
  MontantKilometrageSupplementaire Decimal?               @db.Decimal(21, 2)
  NiveauCarburantDepart            String?                @db.VarChar(20)
  NiveauCarburantRetour            String?                @db.VarChar(20)
  EtatVehiculeDepart               String?                @db.Text
  EtatVehiculeRetour               String?                @db.Text
  PhotosDepart                     String?                @db.Text
  PhotosRetour                     String?                @db.Text
  CommentairesLocataire            String?                @db.Text
  CommentairesProprietaire         String?                @db.Text
  MotifAnnulation                  String?                @db.VarChar(500)
  DateAnnulation                   DateTime?              @db.Timestamptz()
  annuleParId                      Int?                   @map("AnnulePar")
  FraisAnnulation                  Decimal?               @default(0) @db.Decimal(10, 2)
  EstAssurance                     Boolean?               @default(false)
  TypeAssurance                    String?                @db.VarChar(100)
  MontantAssurance                 Decimal?               @default(0) @db.Decimal(10, 2)
  ConducteursSupplementaires       String?                @db.Text
  NombreConducteurs                Int?                   @default(1)
  NotesSpeciales                   String?                @db.Text
  DateConfirmation                 DateTime?              @db.Timestamptz()
  DateDebutEffectif                DateTime?              @db.Timestamptz()
  DateFinEffective                 DateTime?              @db.Timestamptz()
  RetardRetour                     Int?                   @default(0)
  FraisRetard                      Decimal?               @default(0) @db.Decimal(10, 2)
  avis                             Avis?
  Conversations                    Conversations[]
  extensions                       ExtensionReservation[]
  factures                         Facture[]
  incidents                        Incident[]
  reclamations                     Reclamation[]
  annulePar                        User?                  @relation("CanceledBy", fields: [annuleParId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locataire                        User                   @relation("RenterBookings", fields: [locataireId], references: [id], onUpdate: NoAction)
  proprietaire                     User                   @relation("OwnerBookings", fields: [proprietaireId], references: [id], onUpdate: NoAction)
  vehicule                         Vehicle                @relation(fields: [vehiculeId], references: [id], onUpdate: NoAction)
  transactions                     Transaction[]
  UtilisationsCodesPromo           UtilisationCodePromo[]

  @@index([DateCreationReservation])
  @@index([DateDebut, DateFin])
  @@index([locataireId])
  @@index([StatutPaiement])
  @@index([proprietaireId])
  @@index([StatutReservation])
  @@index([vehiculeId])
  @@index([proprietaireId, DateDebut, DateFin])
  @@index([vehiculeId, StatutReservation, DateDebut, DateFin])
  @@map("Reservations")
}

model ExtensionReservation {
  id                    Int         @id @default(autoincrement()) @map("IdentifiantExtension")
  reservationId         Int         @map("IdentifiantReservation")
  NouvelleDateFin       DateTime    @db.Timestamptz()
  AncienneDateFin       DateTime    @db.Timestamptz()
  JoursSupplementaires  Int?
  MontantSupplementaire Decimal     @db.Decimal(10, 2)
  StatutDemande         String?     @default("EnAttente") @db.VarChar(20)
  DateDemande           DateTime?   @default(now()) @db.Timestamptz()
  DateReponse           DateTime?   @db.Timestamptz()
  RaisonExtension       String?     @db.VarChar(500)
  RaisonRefus           String?     @db.VarChar(500)
  reservation           Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([reservationId])
  @@index([StatutDemande])
  @@map("ExtensionsReservations")
}

model Transaction {
  id                         Int          @id @default(autoincrement()) @map("IdentifiantTransaction")
  NumeroTransaction          String       @unique @db.VarChar(100)
  reservationId              Int?         @map("IdentifiantReservation")
  utilisateurId              Int          @map("IdentifiantUtilisateur")
  TypeTransaction            String       @db.VarChar(50)
  Montant                    Decimal      @db.Decimal(10, 2)
  Devise                     String?      @default("XOF") @db.VarChar(3)
  MethodePaiement            String       @db.VarChar(50)
  FournisseurPaiement        String?      @db.VarChar(100)
  ReferenceExterne           String?      @db.VarChar(255)
  StatutTransaction          String?      @default("EnAttente") @db.VarChar(30)
  DateTransaction            DateTime?    @default(now()) @db.Timestamptz()
  DateTraitement             DateTime?    @db.Timestamptz()
  FraisTransaction           Decimal?     @default(0) @db.Decimal(10, 2)
  FraisCommission            Decimal?     @default(0) @db.Decimal(10, 2)
  MontantNet                 Decimal?     @db.Decimal(10, 2)
  Description                String?      @db.VarChar(500)
  DetailsTransaction         String?      @db.Text
  AdresseIPTransaction       String?      @db.VarChar(45)
  DeviceInfo                 String?      @db.VarChar(500)
  CodeErreur                 String?      @db.VarChar(50)
  MessageErreur              String?      @db.VarChar(500)
  NombreTentatives           Int?         @default(1)
  EstRembourse               Boolean?     @default(false)
  DateRemboursement          DateTime?    @db.Timestamptz()
  idTransactionRemboursement Int?         @map("IdentifiantTransactionRemboursement")
  reservation                Reservation? @relation(fields: [reservationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  utilisateur                User         @relation(fields: [utilisateurId], references: [id], onUpdate: NoAction)

  @@index([DateTransaction])
  @@index([reservationId])
  @@index([StatutTransaction])
  @@index([TypeTransaction])
  @@index([utilisateurId])
  @@index([StatutTransaction, DateTransaction])
  @@map("Transactions")
}

model MethodePaiementUtilisateur {
  id                      Int       @id @default(autoincrement()) @map("IdentifiantMethode")
  utilisateurId           Int       @map("IdentifiantUtilisateur")
  TypeMethode             String    @db.VarChar(50)
  EstMethodePrincipale    Boolean?  @default(false)
  Actif                   Boolean?  @default(true)
  Alias                   String?   @db.VarChar(100)
  DerniersChiffres        String?   @db.VarChar(10)
  Fournisseur             String?   @db.VarChar(100)
  DateExpiration          DateTime? @db.Date
  DateAjout               DateTime? @default(now()) @db.Timestamptz()
  DateDerniereUtilisation DateTime? @db.Timestamptz()
  Utilisateurs            User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([EstMethodePrincipale])
  @@index([utilisateurId])
  @@map("MethodesPaiementUtilisateurs")
}

model Facture {
  id            Int         @id @default(autoincrement()) @map("IdentifiantFacture")
  NumeroFacture String      @unique @db.VarChar(50)
  reservationId Int         @map("IdentifiantReservation")
  utilisateurId Int         @map("IdentifiantUtilisateur")
  DateEmission  DateTime?   @default(now()) @db.Timestamptz()
  DateEcheance  DateTime?   @db.Timestamptz()
  MontantHT     Decimal     @db.Decimal(10, 2)
  TauxTVA       Decimal?    @default(0) @db.Decimal(5, 2)
  MontantTVA    Decimal?    @db.Decimal(20, 8)
  MontantTTC    Decimal?    @db.Decimal(21, 8)
  StatutFacture String?     @default("Emise") @db.VarChar(20)
  CheminPDF     String?     @db.VarChar(500)
  DatePaiement  DateTime?   @db.Timestamptz()
  NotesFacture  String?     @db.Text
  reservation   Reservation @relation(fields: [reservationId], references: [id], onUpdate: NoAction)
  Utilisateurs  User        @relation(fields: [utilisateurId], references: [id], onUpdate: NoAction)

  @@index([DateEmission])
  @@index([reservationId])
  @@index([StatutFacture])
  @@index([utilisateurId])
  @@map("Factures")
}

model CodePromo {
  id                         Int                    @id @default(autoincrement()) @map("IdentifiantPromo")
  CodePromo                  String                 @unique @db.VarChar(50)
  TypePromo                  String?                @db.VarChar(20)
  ValeurPromo                Decimal                @db.Decimal(10, 2)
  MontantMinimum             Decimal?               @db.Decimal(10, 2)
  NombreUtilisationsMax      Int?
  NombreUtilisationsActuel   Int?                   @default(0)
  UtilisationsParUtilisateur Int?                   @default(1)
  DateDebut                  DateTime               @db.Timestamptz()
  DateFin                    DateTime               @db.Timestamptz()
  Actif                      Boolean?               @default(true)
  CategoriesApplicables      String?                @db.Text
  VehiculesApplicables       String?                @db.Text
  UtilisateursApplicables    String?                @db.Text
  Description                String?                @db.VarChar(500)
  CreePar                    Int?
  DateCreation               DateTime?              @default(now()) @db.Timestamptz()
  Utilisateurs               User?                  @relation(fields: [CreePar], references: [id], onDelete: NoAction, onUpdate: NoAction)
  utilisations               UtilisationCodePromo[]

  @@index([Actif])
  @@index([CodePromo])
  @@index([DateDebut, DateFin])
  @@map("CodesPromo")
}

model UtilisationCodePromo {
  id              Int         @id @default(autoincrement()) @map("IdentifiantUtilisation")
  promoId         Int         @map("IdentifiantPromo")
  utilisateurId   Int         @map("IdentifiantUtilisateur")
  reservationId   Int         @map("IdentifiantReservation")
  MontantRemise   Decimal     @db.Decimal(10, 2)
  DateUtilisation DateTime?   @default(now()) @db.Timestamptz()
  promo           CodePromo   @relation(fields: [promoId], references: [id], onUpdate: NoAction)
  Reservations    Reservation @relation(fields: [reservationId], references: [id], onUpdate: NoAction)
  Utilisateurs    User        @relation(fields: [utilisateurId], references: [id], onUpdate: NoAction)

  @@index([promoId])
  @@index([reservationId])
  @@index([utilisateurId])
  @@map("UtilisationsCodesPromo")
}

model ProgrammeFidelite {
  id                   Int       @id @default(autoincrement()) @map("IdentifiantProgramme")
  NomProgramme         String    @db.VarChar(100)
  Niveau               String?   @db.VarChar(50)
  SeuilPoints          Int
  PourcentageRemise    Decimal?  @default(0) @db.Decimal(5, 2)
  PrioriteSuppor       Boolean?  @default(false)
  AnnulationGratuite   Boolean?  @default(false)
  AccesExclusif        Boolean?  @default(false)
  SurclassementGratuit Boolean?  @default(false)
  Avantages            String?   @db.Text
  CouleurBadge         String?   @db.VarChar(20)
  IconeBadge           String?   @db.VarChar(255)
  Actif                Boolean?  @default(true)
  DateCreation         DateTime? @default(now()) @db.Timestamptz()

  @@index([Niveau])
  @@index([SeuilPoints])
  @@map("ProgrammeFidelite")
}

model PointFidelite {
  id              Int       @id @default(autoincrement()) @map("IdentifiantPoint")
  utilisateurId   Int       @map("IdentifiantUtilisateur")
  TypeAcquisition String?   @db.VarChar(50)
  PointsAcquis    Int
  PointsUtilises  Int?      @default(0)
  SoldePoints     Int?
  DateAcquisition DateTime? @default(now()) @db.Timestamptz()
  DateExpiration  DateTime? @db.Timestamptz()
  idSource        Int?      @map("IdentifiantSource")
  TypeSource      String?   @db.VarChar(50)
  Description     String?   @db.VarChar(500)
  EstExpire       Int
  utilisateur     User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([DateAcquisition])
  @@index([DateExpiration])
  @@index([TypeAcquisition])
  @@index([utilisateurId])
  @@map("PointsFidelite")
}

model ProgrammeParrainage {
  id                         Int       @id @default(autoincrement()) @map("IdentifiantParrainage")
  parrainId                  Int       @map("IdentifiantParrain")
  filleulId                  Int?      @map("IdentifiantFilleul")
  CodeParrainage             String    @unique @db.VarChar(50)
  EmailFilleul               String?   @db.VarChar(255)
  DateInvitation             DateTime? @default(now()) @db.Timestamptz()
  DateInscription            DateTime? @db.Timestamptz()
  PointsParrain              Int?      @default(0)
  PointsFilleul              Int?      @default(0)
  RemiseParrain              Decimal?  @default(0) @db.Decimal(10, 2)
  RemiseFilleul              Decimal?  @default(0) @db.Decimal(10, 2)
  CommissionParrain          Decimal?  @db.Decimal(5, 2)
  StatutParrainage           String?   @default("EnAttente") @db.VarChar(20)
  PremierAchatEffectue       Boolean?  @default(false)
  DatePremierAchat           DateTime? @db.Timestamptz()
  MontantPremierAchat        Decimal?  @db.Decimal(10, 2)
  RecompensesAttribuees      Boolean?  @default(false)
  DateAttributionRecompenses DateTime? @db.Timestamptz()
  filleul                    User?     @relation("Referred", fields: [filleulId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parrain                    User      @relation("Referrer", fields: [parrainId], references: [id], onUpdate: NoAction)

  @@unique([parrainId, filleulId])
  @@index([CodeParrainage])
  @@index([filleulId])
  @@index([parrainId])
  @@index([StatutParrainage])
  @@map("ProgrammeParrainage")
}

model Notification {
  id                   Int       @id @default(autoincrement()) @map("IdentifiantNotification")
  utilisateurId        Int       @map("IdentifiantUtilisateur")
  TypeNotification     String    @db.VarChar(50)
  TitreNotification    String    @db.VarChar(255)
  MessageNotification  String    @db.Text
  LienNotification     String?   @db.VarChar(500)
  IconeNotification    String?   @db.VarChar(50)
  PrioriteNotification String?   @default("Normal") @db.VarChar(20)
  CanalEnvoi           String?   @db.VarChar(20)
  DateCreation         DateTime? @default(now()) @db.Timestamptz()
  DateEnvoi            DateTime? @db.Timestamptz()
  DateLecture          DateTime? @db.Timestamptz()
  EstLu                Boolean?  @default(false)
  EstArchive           Boolean?  @default(false)
  MetaDonnees          String?   @db.Text
  utilisateur          User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([DateCreation])
  @@index([EstLu])
  @@index([PrioriteNotification])
  @@index([TypeNotification])
  @@index([utilisateurId])
  @@map("Notifications")
}

model Message {
  id                                                          Int           @id @default(autoincrement()) @map("IdentifiantMessage")
  conversationId                                              Int           @map("IdentifiantConversation")
  expediteurId                                                Int           @map("IdentifiantExpediteur")
  destinataireId                                              Int           @map("IdentifiantDestinataire")
  ContenuMessage                                              String        @db.Text
  TypeMessage                                                 String?       @default("Texte") @db.VarChar(20)
  PiecesJointes                                               String?       @db.Text
  DateEnvoi                                                   DateTime?     @default(now()) @db.Timestamptz()
  DateLecture                                                 DateTime?     @db.Timestamptz()
  EstLu                                                       Boolean?      @default(false)
  EstArchive                                                  Boolean?      @default(false)
  EstSupprime                                                 Boolean?      @default(false)
  Conversations                                               Conversations @relation(fields: [conversationId], references: [IdentifiantConversation], onDelete: Cascade, onUpdate: NoAction)
  Utilisateurs_Messages_IdentifiantDestinataireToUtilisateurs User          @relation("Messages_IdentifiantDestinataireToUtilisateurs", fields: [destinataireId], references: [id], onUpdate: NoAction)
  expediteur                                                  User          @relation("SenderMessages", fields: [expediteurId], references: [id], onUpdate: NoAction)

  @@index([conversationId])
  @@index([DateEnvoi])
  @@index([destinataireId])
  @@index([EstLu])
  @@index([expediteurId])
  @@map("Messages")
}

model Avis {
  id                     Int               @id @default(autoincrement()) @map("IdentifiantAvis")
  reservationId          Int               @unique @map("IdentifiantReservation")
  auteurId               Int               @map("IdentifiantAuteur")
  cibleId                Int               @map("IdentifiantCible")
  TypeCible              String            @db.VarChar(20)
  NoteGlobale            Decimal           @db.Decimal(3, 2)
  NoteProprete           Decimal?          @db.Decimal(3, 2)
  NoteConformite         Decimal?          @db.Decimal(3, 2)
  NoteCommunication      Decimal?          @db.Decimal(3, 2)
  NoteEtatVehicule       Decimal?          @db.Decimal(3, 2)
  NoteRapportQualitePrix Decimal?          @db.Decimal(3, 2)
  CommentaireAvis        String?           @db.VarChar(2000)
  PhotosAvis             String?           @db.Text
  RecommandeCible        Boolean?          @default(true)
  StatutAvis             String?           @default("Publie") @db.VarChar(20)
  DateCreation           DateTime?         @default(now()) @db.Timestamptz()
  DateModification       DateTime?         @db.Timestamptz()
  NombreSignalements     Int?              @default(0)
  NombreUtile            Int?              @default(0)
  NombreInutile          Int?              @default(0)
  ReponseProprietaire    String?           @db.Text
  DateReponse            DateTime?         @db.Timestamptz()
  auteur                 User              @relation("ReviewAuthor", fields: [auteurId], references: [id], onUpdate: NoAction)
  reservation            Reservation       @relation(fields: [reservationId], references: [id], onUpdate: NoAction)
  SignalementsAvis       SignalementsAvis[]

  @@index([auteurId])
  @@index([cibleId, TypeCible])
  @@index([DateCreation])
  @@index([NoteGlobale(sort: Desc)])
  @@index([reservationId])
  @@index([StatutAvis])
  @@map("Avis")
}

model Reclamation {
  id                                               Int          @id @default(autoincrement()) @map("IdentifiantReclamation")
  NumeroReclamation                                String       @unique @db.VarChar(50)
  reservationId                                    Int?         @map("IdentifiantReservation")
  reclamantId                                      Int          @map("IdentifiantReclamant")
  TypeReclamation                                  String       @db.VarChar(50)
  CategorieReclamation                             String?      @db.VarChar(50)
  SujetReclamation                                 String       @db.VarChar(255)
  DescriptionReclamation                           String       @db.Text
  PieceJointes                                     String?      @db.Text
  MontantReclame                                   Decimal?     @db.Decimal(10, 2)
  StatutReclamation                                String?      @default("Ouverte") @db.VarChar(30)
  PrioriteReclamation                              String?      @default("Normal") @db.VarChar(20)
  DateCreation                                     DateTime?    @default(now()) @db.Timestamptz()
  DateResolution                                   DateTime?    @db.Timestamptz()
  DateFermeture                                    DateTime?    @db.Timestamptz()
  AssigneA                                         Int?
  ReponseReclamation                               String?      @db.Text
  ActionsPrises                                    String?      @db.Text
  MontantRembourse                                 Decimal?     @db.Decimal(10, 2)
  SatisfactionClient                               Decimal?     @db.Decimal(3, 2)
  Utilisateurs_Reclamations_AssigneAToUtilisateurs User?        @relation("Reclamations_AssigneAToUtilisateurs", fields: [AssigneA], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reclamant                                        User         @relation("ComplaintUser", fields: [reclamantId], references: [id], onUpdate: NoAction)
  reservation                                      Reservation? @relation(fields: [reservationId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([DateCreation])
  @@index([PrioriteReclamation])
  @@index([reclamantId])
  @@index([reservationId])
  @@index([StatutReclamation])
  @@index([TypeReclamation])
  @@map("Reclamations")
}

model Incident {
  id                        Int         @id @default(autoincrement()) @map("IdentifiantIncident")
  NumeroIncident            String      @unique @db.VarChar(50)
  reservationId             Int         @map("IdentifiantReservation")
  vehiculeId                Int         @map("IdentifiantVehicule")
  TypeIncident              String      @db.VarChar(50)
  GraviteIncident           String      @db.VarChar(20)
  DescriptionIncident       String      @db.Text
  DateIncident              DateTime    @db.Timestamptz()
  LieuIncident              String?     @db.VarChar(500)
  PhotosIncident            String?     @db.Text
  RapportPolice             String?     @db.VarChar(500)
  NumeroConstat             String?     @db.VarChar(100)
  TierImplique              Boolean?    @default(false)
  InfoTiers                 String?     @db.Text
  AssuranceNotifiee         Boolean?    @default(false)
  DateNotificationAssurance DateTime?   @db.Timestamptz()
  NumeroSinistre            String?     @db.VarChar(100)
  EstimationDommages        Decimal?    @db.Decimal(10, 2)
  CoutReparations           Decimal?    @db.Decimal(10, 2)
  ResponsabiliteLocataire   Boolean?
  StatutTraitement          String?     @default("Declare") @db.VarChar(30)
  DateDeclaration           DateTime?   @default(now()) @db.Timestamptz()
  DateResolution            DateTime?   @db.Timestamptz()
  TraitePar                 Int?
  NotesTraitement           String?     @db.Text
  reservation               Reservation @relation(fields: [reservationId], references: [id], onUpdate: NoAction)
  Utilisateurs              User?       @relation(fields: [TraitePar], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vehicule                  Vehicle     @relation(fields: [vehiculeId], references: [id], onUpdate: NoAction)

  @@index([DateIncident])
  @@index([reservationId])
  @@index([StatutTraitement])
  @@index([TypeIncident])
  @@index([vehiculeId])
  @@map("Incidents")
}

model Favori {
  id                Int       @id @default(autoincrement()) @map("IdentifiantFavori")
  utilisateurId     Int       @map("IdentifiantUtilisateur")
  vehiculeId        Int       @map("IdentifiantVehicule")
  DateAjout         DateTime? @default(now()) @db.Timestamptz()
  NotesPersonnelles String?   @db.VarChar(500)
  utilisateur       User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vehicule          Vehicle   @relation(fields: [vehiculeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([utilisateurId, vehiculeId])
  @@index([DateAjout])
  @@index([utilisateurId])
  @@index([vehiculeId])
  @@map("Favoris")
}

model RecherchesSauvegardee {
  id                      Int       @id @default(autoincrement()) @map("IdentifiantRecherche")
  utilisateurId           Int       @map("IdentifiantUtilisateur")
  NomRecherche            String    @db.VarChar(200)
  CriteresRecherche       String    @db.Text
  NotificationsActives    Boolean?  @default(true)
  FrequenceNotifications  String?   @db.VarChar(20)
  DateCreation            DateTime? @default(now()) @db.Timestamptz()
  DateDerniereUtilisation DateTime? @db.Timestamptz()
  NombreUtilisations      Int?      @default(0)
  utilisateur             User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([DateCreation])
  @@index([utilisateurId])
  @@map("RecherchesSauvegardees")
}

model RegleTarificationDynamique {
  id                 Int       @id @default(autoincrement()) @map("IdentifiantRegle")
  vehiculeId         Int       @map("IdentifiantVehicule")
  TypeCondition      String?   @db.VarChar(50)
  ValeurCondition    String?   @db.VarChar(200)
  TypeModificateur   String?   @db.VarChar(20)
  ValeurModificateur Decimal   @db.Decimal(10, 2)
  Operation          String?   @db.VarChar(10)
  PrixMinimum        Decimal?  @db.Decimal(10, 2)
  PrixMaximum        Decimal?  @db.Decimal(10, 2)
  DateDebut          DateTime  @db.Timestamptz()
  DateFin            DateTime? @db.Timestamptz()
  HeureDebut         DateTime? @db.Time()
  HeureFin           DateTime? @db.Time()
  JoursSemaine       String?   @db.VarChar(50)
  Priorite           Int?      @default(0)
  Actif              Boolean?  @default(true)
  Description        String?   @db.VarChar(500)
  vehicule           Vehicle   @relation(fields: [vehiculeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([Actif])
  @@index([DateDebut, DateFin])
  @@index([Priorite(sort: Desc)])
  @@index([vehiculeId])
  @@map("ReglesTarificationDynamique")
}

model HistoriquePrixVehicule {
  id                BigInt    @id @default(autoincrement()) @map("IdentifiantHistorique")
  vehiculeId        Int       @map("IdentifiantVehicule")
  PrixJournalier    Decimal   @db.Decimal(10, 2)
  PrixHebdomadaire  Decimal?  @db.Decimal(10, 2)
  PrixMensuel       Decimal?  @db.Decimal(10, 2)
  FacteursInfluence String?   @db.Text
  TauxOccupation    Decimal?  @db.Decimal(5, 2)
  DemandePrevue     Decimal?  @db.Decimal(5, 2)
  SaisonTouristique String?   @db.VarChar(50)
  EvenementsLocaux  String?   @db.Text
  DateApplication   DateTime? @default(now()) @db.Timestamptz()
  vehicule          Vehicle   @relation(fields: [vehiculeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([vehiculeId, DateApplication])
  @@map("HistoriquePrixVehicules")
}

model AggregationUtilisateur {
  id                           Int       @id @default(autoincrement()) @map("IdentifiantAggregation")
  utilisateurId                Int       @unique @map("IdentifiantUtilisateur")
  NombreReservationsTotal      Int?      @default(0)
  NombreReservationsConfirmees Int?      @default(0)
  NombreReservationsAnnulees   Int?      @default(0)
  TauxAnnulation               Float?
  DureeTotalLocations          Int?      @default(0)
  MontantTotalDepense          Decimal?  @default(0) @db.Decimal(15, 2)
  MontantMoyenReservation      Decimal?  @db.Decimal(26, 13)
  NoteMoyenneDonnee            Decimal?  @db.Decimal(3, 2)
  NoteMoyenneRecue             Decimal?  @db.Decimal(3, 2)
  NombreAvisDonnes             Int?      @default(0)
  NombreAvisRecus              Int?      @default(0)
  DerniereReservationDate      DateTime? @db.Timestamptz()
  DerniereConnexionDate        DateTime? @db.Timestamptz()
  DernierPaiementDate          DateTime? @db.Timestamptz()
  CategoriePreferee            Int?
  VillePreferee                String?   @db.VarChar(100)
  MarquePreferee               Int?
  BudgetMoyen                  Decimal?  @db.Decimal(10, 2)
  DureeMoyenneLocation         Int?
  TauxReponse                  Decimal?  @db.Decimal(5, 2)
  DelaiMoyenReponse            Int?
  TauxConfirmation             Decimal?  @db.Decimal(5, 2)
  DateCalcul                   DateTime? @default(now()) @db.Timestamptz()
  DateMiseAJour                DateTime? @db.Timestamptz()
  utilisateur                  User      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([DateCalcul])
  @@index([DateMiseAJour])
  @@map("AggregationsUtilisateurs")
}

model A_B_Tests {
  IdentifiantTest         Int       @id @default(autoincrement())
  CodeTest                String    @unique @db.VarChar(100)
  NomTest                 String    @db.VarChar(100)
  DescriptionTest         String?   @db.Text
  ObjectifTest            String?   @db.VarChar(500)
  HypotheseTest           String?   @db.Text
  MetriquePrincipale      String?   @db.VarChar(100)
  PopulationCible         String?   @db.Text
  TailleEchantillon       Int?
  PourcentageVarianteA    Int?      @default(50)
  PourcentageVarianteB    Int?      @default(50)
  VarianteA               String?   @db.Text
  VarianteB               String?   @db.Text
  DateDebut               DateTime? @db.Timestamptz()
  DateFin                 DateTime? @db.Timestamptz()
  DureeMinimaleJours      Int?      @default(7)
  StatutTest              String?   @default("Brouillon") @db.VarChar(20)
  ParticipantsVarianteA   Int?      @default(0)
  ParticipantsVarianteB   Int?      @default(0)
  ConversionsVarianteA    Int?      @default(0)
  ConversionsVarianteB    Int?      @default(0)
  TauxConversionA         Float?
  TauxConversionB         Float?
  SignificanceStatistique Decimal?  @db.Decimal(5, 4)
  VarianteGagnante        String?   @db.VarChar(1)
  Resultats               String?   @db.Text
  CreePar                 Int?
  DateCreation            DateTime? @default(now()) @db.Timestamptz()
  Utilisateurs            User?     @relation(fields: [CreePar], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([CodeTest])
  @@index([DateDebut, DateFin])
  @@index([StatutTest])
}

model CacheRecherches {
  IdentifiantCache    Int       @id @default(autoincrement())
  CleCache            String    @unique @db.VarChar(500)
  Resultats           String    @db.Text
  NombreResultats     Int
  DateCreation        DateTime? @default(now()) @db.Timestamptz()
  DateExpiration      DateTime  @db.Timestamptz()
  CompteUtilisations  Int?      @default(0)
  DerniereUtilisation DateTime? @db.Timestamptz()
  ParametresRecherche String?   @db.Text

  @@index([DerniereUtilisation(sort: Desc)])
  @@index([DateExpiration])
  @@index([CompteUtilisations(sort: Desc)])
}

model CacheStatistiques {
  IdentifiantStatCache Int       @id @default(autoincrement())
  TypeCache            String    @db.VarChar(50)
  Periode              String?   @db.VarChar(20)
  RequetesTotal        Int?      @default(0)
  RequetesCache        Int?      @default(0)
  RequetesMiss         Int?      @default(0)
  TauxReussite         Float?
  TempsMoyenSansCache  Decimal?  @db.Decimal(10, 4)
  TempsMoyenAvecCache  Decimal?  @db.Decimal(10, 4)
  GainPerformance      Decimal?  @db.Decimal(30, 15)
  DateDebut            DateTime  @db.Timestamptz()
  DateFin              DateTime  @db.Timestamptz()
  DateCalcul           DateTime? @default(now()) @db.Timestamptz()

  @@index([DateCalcul])
  @@index([TypeCache])
}

model ConfigurationBusinessRules {
  IdentifiantRegle                                                 Int       @id @default(autoincrement())
  CodeRegle                                                        String    @unique @db.VarChar(100)
  TypeRegle                                                        String    @db.VarChar(100)
  NomRegle                                                         String    @db.VarChar(200)
  DescriptionRegle                                                 String?   @db.Text
  Conditions                                                       String    @db.Text
  Actions                                                          String    @db.Text
  Priorite                                                         Int?      @default(0)
  Actif                                                            Boolean?  @default(true)
  DateDebut                                                        DateTime? @default(now()) @db.Timestamptz()
  DateFin                                                          DateTime? @db.Timestamptz()
  CreePar                                                          Int?
  DateCreation                                                     DateTime? @default(now()) @db.Timestamptz()
  ModifiePar                                                       Int?
  DateModification                                                 DateTime? @db.Timestamptz()
  NombreExecutions                                                 Int?      @default(0)
  DateDerniereExecution                                            DateTime? @db.Timestamptz()
  Utilisateurs_ConfigurationBusinessRules_CreeParToUtilisateurs    User?     @relation("ConfigurationBusinessRules_CreeParToUtilisateurs", fields: [CreePar], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Utilisateurs_ConfigurationBusinessRules_ModifieParToUtilisateurs User?     @relation("ConfigurationBusinessRules_ModifieParToUtilisateurs", fields: [ModifiePar], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([Actif])
  @@index([CodeRegle])
  @@index([Priorite(sort: Desc)])
  @@index([TypeRegle])
}

model Conversations {
  IdentifiantConversation                                          Int          @id @default(autoincrement())
  IdentifiantUtilisateur1                                          Int
  IdentifiantUtilisateur2                                          Int
  IdentifiantReservation                                           Int?
  IdentifiantVehicule                                              Int?
  SujetConversation                                                String?      @db.VarChar(255)
  StatutConversation                                               String?      @default("Active") @db.VarChar(20)
  DateCreation                                                     DateTime?    @default(now()) @db.Timestamptz()
  DateDernierMessage                                               DateTime?    @db.Timestamptz()
  NombreMessages                                                   Int?         @default(0)
  Reservations                                                     Reservation? @relation(fields: [IdentifiantReservation], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Utilisateurs_Conversations_IdentifiantUtilisateur1ToUtilisateurs User         @relation("Conversations_IdentifiantUtilisateur1ToUtilisateurs", fields: [IdentifiantUtilisateur1], references: [id], onUpdate: NoAction)
  Utilisateurs_Conversations_IdentifiantUtilisateur2ToUtilisateurs User         @relation("Conversations_IdentifiantUtilisateur2ToUtilisateurs", fields: [IdentifiantUtilisateur2], references: [id], onUpdate: NoAction)
  Vehicules                                                        Vehicle?     @relation(fields: [IdentifiantVehicule], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Messages                                                         Message[]

  @@index([IdentifiantReservation])
  @@index([StatutConversation])
  @@index([IdentifiantUtilisateur1])
  @@index([IdentifiantUtilisateur2])
}

model DeclencheursNotifications {
  IdentifiantDeclencheur Int                    @id @default(autoincrement())
  TypeDeclencheur        String                 @db.VarChar(100)
  NomDeclencheur         String                 @db.VarChar(200)
  IdentifiantTemplate    Int
  DelaiMinutes           Int?                   @default(0)
  Conditions             String?                @db.Text
  Actif                  Boolean?               @default(true)
  Priorite               Int?                   @default(5)
  DateCreation           DateTime?              @default(now()) @db.Timestamptz()
  TemplatesNotifications TemplatesNotifications @relation(fields: [IdentifiantTemplate], references: [IdentifiantTemplate], onUpdate: NoAction)

  @@index([Actif])
  @@index([Priorite(sort: Desc)])
  @@index([TypeDeclencheur])
}

model DistancesPrecalculees {
  IdentifiantOrigine     Int
  IdentifiantDestination Int
  DistanceMetres         Int
  DureeMinutes           Int
  DateCalcul             DateTime? @default(now()) @db.Timestamptz()

  @@id([IdentifiantOrigine, IdentifiantDestination])
  @@index([IdentifiantDestination])
  @@index([IdentifiantOrigine])
}

model DonneesChiffrees {
  IdentifiantChiffrement Int       @id @default(autoincrement())
  TableOrigine           String    @db.VarChar(100)
  ColonneOrigine         String    @db.VarChar(100)
  IdentifiantLigne       Int
  DonneesChiffrees       Bytes
  Algorithme             String?   @default("AES_256") @db.VarChar(50)
  VecteurInitialisation  Bytes?
  DateChiffrement        DateTime? @default(now()) @db.Timestamptz()
  ChiffrePar             Int?
  Utilisateurs           User?     @relation(fields: [ChiffrePar], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([TableOrigine, ColonneOrigine, IdentifiantLigne])
}

model JournalAudit {
  IdentifiantAudit       BigInt    @id @default(autoincrement())
  TypeAction             String    @db.VarChar(50)
  TableCible             String    @db.VarChar(100)
  IdentifiantLigne       Int
  IdentifiantUtilisateur Int?
  ActionEffectuee        String?   @db.VarChar(20)
  ValeursPrecedentes     String?   @db.Text
  NouvellesValeurs       String?   @db.Text
  AdresseIP              String?   @db.VarChar(45)
  UserAgent              String?   @db.VarChar(500)
  DateAction             DateTime? @default(now()) @db.Timestamptz()
  DetailsSupplementaires String?   @db.Text
  Utilisateurs           User?     @relation(fields: [IdentifiantUtilisateur], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([DateAction])
  @@index([TableCible])
  @@index([TypeAction])
  @@index([IdentifiantUtilisateur])
}

model LogsErreurs {
  IdentifiantLog         BigInt    @id @default(autoincrement())
  TypeErreur             String    @db.VarChar(50)
  MessageErreur          String    @db.Text
  StackTrace             String?   @db.Text
  Gravite                String?   @db.VarChar(20)
  IdentifiantUtilisateur Int?
  URL                    String?   @db.VarChar(500)
  MethodeHTTP            String?   @db.VarChar(10)
  AdresseIP              String?   @db.VarChar(45)
  UserAgent              String?   @db.VarChar(500)
  DateErreur             DateTime? @default(now()) @db.Timestamptz()
  Environnement          String?   @db.VarChar(20)
  Version                String?   @db.VarChar(20)
  EstResolu              Boolean?  @default(false)
  DateResolution         DateTime? @db.Timestamptz()
  Utilisateurs           User?     @relation(fields: [IdentifiantUtilisateur], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([DateErreur])
  @@index([EstResolu])
  @@index([Gravite])
  @@index([TypeErreur])
}

model SignalementsAvis {
  IdentifiantSignalement                                           Int       @id @default(autoincrement())
  IdentifiantAvis                                                  Int
  IdentifiantSignaleur                                             Int
  MotifSignalement                                                 String    @db.VarChar(50)
  DescriptionSignalement                                           String?   @db.Text
  DateSignalement                                                  DateTime? @default(now()) @db.Timestamptz()
  StatutTraitement                                                 String?   @default("EnAttente") @db.VarChar(20)
  DateTraitement                                                   DateTime? @db.Timestamptz()
  TraitePar                                                        Int?
  CommentairesTraitement                                           String?   @db.VarChar(500)
  Avis                                                             Avis      @relation(fields: [IdentifiantAvis], references: [id], onUpdate: NoAction)
  Utilisateurs_SignalementsAvis_IdentifiantSignaleurToUtilisateurs User      @relation("SignalementsAvis_IdentifiantSignaleurToUtilisateurs", fields: [IdentifiantSignaleur], references: [id], onUpdate: NoAction)
  Utilisateurs_SignalementsAvis_TraiteParToUtilisateurs            User?     @relation("SignalementsAvis_TraiteParToUtilisateurs", fields: [TraitePar], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([IdentifiantAvis])
  @@index([IdentifiantSignaleur])
  @@index([StatutTraitement])
}

model TemplatesNotifications {
  IdentifiantTemplate       Int                         @id @default(autoincrement())
  TypeNotification          String                      @unique @db.VarChar(100)
  NomTemplate               String                      @db.VarChar(200)
  TitreTemplate             String                      @db.VarChar(255)
  CorpsTemplate             String                      @db.Text
  CorpsHTML                 String?                     @db.Text
  CorpsSMS                  String?                     @db.VarChar(500)
  VariablesDisponibles      String?                     @db.Text
  CanauxDisponibles         String?                     @db.Text
  Categorie                 String?                     @db.VarChar(50)
  Langue                    String?                     @default("fr") @db.VarChar(10)
  DateCreation              DateTime?                   @default(now()) @db.Timestamptz()
  DateModification          DateTime?                   @db.Timestamptz()
  Actif                     Boolean?                    @default(true)
  DeclencheursNotifications DeclencheursNotifications[]

  @@index([Actif])
  @@index([Categorie])
  @@index([TypeNotification])
}

model ZonesGeographiques {
  IdentifiantZone          Int                    @id @default(autoincrement())
  NomZone                  String                 @db.VarChar(100)
  TypeZone                 String?                @db.VarChar(50)
  ParentZone               Int?
  GeoJSON                  String?                @db.Text
  CentroidLatitude         Decimal?               @db.Decimal(10, 8)
  CentroidLongitude        Decimal?               @db.Decimal(11, 8)
  RayonMetres              Int?
  NombreVehicules          Int?                   @default(0)
  PrixMoyen                Decimal?               @db.Decimal(10, 2)
  Popularite               Int?                   @default(0)
  DateCreation             DateTime?              @default(now()) @db.Timestamptz()
  DateMiseAJour            DateTime?              @db.Timestamptz()
  ZonesGeographiques       ZonesGeographiques?    @relation("ZonesGeographiquesToZonesGeographiques", fields: [ParentZone], references: [IdentifiantZone], onDelete: NoAction, onUpdate: NoAction)
  other_ZonesGeographiques ZonesGeographiques[]   @relation("ZonesGeographiquesToZonesGeographiques")

  @@index([CentroidLatitude, CentroidLongitude])
  @@index([Popularite(sort: Desc)])
  @@index([TypeZone])
}
